{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MedCraft User Secrets appsettings (extended)",
  "allOf": [
    { "$ref": "https://json.schemastore.org/appsettings.json" },
    {
      "type": "object",
      "properties": {
        "ConnectionStrings": {
          "type": "object",
          "properties": {
            "ConnectionTemplate": {
              "type": "string",
              "description": "Postgres connection string template to be used for general application connections. Omit any Database name, which is set at runtime.",
              "not": {
                "pattern": "(^|;)\\s*(?:[Dd]atabase|[Dd]bname)\\s*="
              },
              "errorMessage": {
                "not": "Do not include Database name in the connection string."
              }
            }
          },
          "required": [ "ConnectionTemplate" ]
        },
        "Connection": {
          "type": "object",
          "properties": {
            "DbNameTemplate": {
              "type": "string",
              "description": "A template to map the instance database names. Useful for mapping database to externally configured connection pools. Use '{0}' as the database name placeholder",
              "default": "{0}"
            },
            "CommonDbName": {
              "type": "string",
              "description": "Name of the common database shared by all instances",
              "default": "common"
            }
          }
        },
        "Authentication": {
          "type": "object",
          "properties": {
            "OpenIdConnect": {
              "type": "object",
              "properties": {
                "ClientId": { "type": "string" },
                "ClientSecret": { "type": "string" },
                "ClientCertificate": {
                  "type": "object",
                  "description": "Base64 serialized pfx certificate used for a JWT client assertion",
                  "properties": {
                    "ContentBase64": {
                      "type": "string",
                      "description": "Base64 encoding of pfx certificate file"
                    },
                    "Password": {
                      "type": "string",
                      "description": "Password for X509 certificate"
                    }
                  },
                  "required": [ "ContentBase64", "Password" ]
                },
                "ResponseType": { "type": "string" },
                "AccessDeniedPath": { "type": "string" },
                "Scope": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "oneOf": [
                {
                  "required": [ "ClientId", "ClientSecret", "Scope" ]
                },
                {
                  "required": [ "ClientId", "ClientCertificate", "Scope" ]
                }
              ]
            }
          },
          "required": [ "OpenIdConnect" ]
        }
      },
      "required": [ "ConnectionStrings", "Authentication" ]
    }
  ]
}
